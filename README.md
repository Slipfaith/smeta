# RateApp — калькулятор стоимости перевода

RateApp — это инструмент для проджект-менеджеров, который автоматизирует создание коммерческих предложений по переводу и сопутствующим услугам. Приложение разработано на Python с использованием PySide6 и поддерживает работу как в режиме разработки, так и в виде упакованного PyInstaller исполняемого файла.

## Основные возможности

- **Управление проектами**: ведение карточки проекта с указанием названия, клиента, контактов, выбором юридического лица, валюты и ставки НДС
- **Языковые пары**: управление языковыми парами с переключением отображения названий (RU/EN), автоматическим подсчетом объёмов и фильтром «только новые слова и повторы»
- **Импорт отчётов**: автоматический импорт отчётов Trados и Smartcat через перетаскивание XML-файлов с распределением данных по категориям объёмов
- **Загрузка тарифов**: импорт тарифов из Excel-файлов (варианты R1/R2 в разных валютах) с привязкой к языковым парам
- **Расчет стоимости**: таблицы запуска проекта и дополнительных услуг с автоматическим пересчётом ставок и поддержкой нескольких блоков
- **Экспорт результатов**: сохранение проектов в JSON, экспорт коммерческих предложений в Excel и PDF с использованием корпоративных шаблонов
- **Конвертация валют**: автоматическая конвертация ставок из USD в рубли по заданному курсу с учётом валютных символов
- **Автообновления**: автоматическая проверка обновлений через GitHub API

## Структура проекта

```
.
├── main.py                 # Точка входа, инициализация GUI
├── gui/                    # Виджеты PySide6 и визуальная логика
├── logic/                  # Экспорт, парсинг отчётов, конфигурации
├── languages/              # CSV-справочник языков
├── templates/              # Excel-шаблоны коммерческих предложений
├── updater/                # Модуль проверки обновлений
├── resource_utils.py       # Утилита поиска ресурсов (для PyInstaller)
└── requirements.txt        # Python-зависимости
```

## Системные требования

- **Python**: версия 3.10 или новее (используются объединённые типы `list | None`)
- **Зависимости**: PySide6 и библиотеки из `requirements.txt` (`langcodes`, `pycountry`, `Babel`, `openpyxl`, `Pillow`, `requests`, `psutil`)
- **Windows + Excel**: для экспорта в PDF и применения региональных настроек чисел (через COM-интерфейс `win32com`)
- **Интернет**: для проверки обновлений и отслеживания процессов Excel


При запуске приложение автоматически загружает сохранённые языки и ПМ из `%APPDATA%` и проверяет наличие обновлений.

## Руководство пользователя

### Информация о проекте

Заполните основные поля: название проекта, клиент, контактное лицо и email. Выберите юридическое лицо и валюту. Для юрлица «Артфест» доступно поле НДС, для остальных ставка автоматически устанавливается в 0%. Кнопка «Конвертировать в рубли» переводит все ставки из USD в RUB по указанному курсу.

### Работа с языковыми парами

- Добавляйте пары через выпадающие списки со справочником языков
- Переключайте язык отображения слайдером (RU ↔ EN)
- Используйте режим «Только новые слова и повторы» для краткого расчёта
- Импортируйте XML-отчёты Trados/Smartcat перетаскиванием — пары создаются автоматически с заполнением объёмов по категориям

### Импорт тарифов

Через меню «Импорт ставок → Импортировать из Excel» загрузите файл с листами `R1_<валюта>` или `R2_<валюта>`. В диалоге сопоставления выберите нужную колонку тарифов и примените её ко всем языковым парам.

### Управление услугами

- **Запуск проекта**: добавляйте фиксированные или пользовательские строки со ставками, удаляйте/восстанавливайте позиции
- **Дополнительные услуги**: создавайте несколько таблиц с произвольными услугами, единицами измерения и ставками

Все суммы пересчитываются автоматически.

### Сохранение и экспорт

- **Сохранить проект**: экспорт данных в JSON-формат
- **Сохранить Excel**: создание коммерческого предложения по корпоративному шаблону с логотипом и форматированием
- **Сохранить PDF**: генерация Excel-файла с последующей конвертацией в PDF (требует Excel на Windows)
- **Загрузка проекта**: восстановление всех данных из JSON-файла

Все операции сопровождаются индикаторами прогресса и предупреждениями о незаполненных полях.

### Обновления

Меню «Обновление → Проверить обновления» проверяет последний релиз на GitHub и предлагает скачать новую версию с проверкой целостности файла. В разделе «О программе» отображается текущая версия и информация о сборке.

## Конфигурационные файлы

- `languages/languages.csv` — базовый справочник языков и стран
- `%APPDATA%/ProjectCalculator/languages.json` — пользовательские языки
- `%APPDATA%/ProjectCalculator/pm_history.json` — история проджект-менеджеров
- `logic/legal_entities.json` — привязка юридических лиц к Excel-шаблонам

## Сборка исполняемого файла

Пример команды PyInstaller для создания standalone-версии:

```powershell
pyinstaller ^
  --onefile ^
  --windowed ^
  --icon "rateapp.ico" ^
  --add-data "languages;languages" ^
  --add-data "templates;templates" ^
  main.py
```

При необходимости добавьте дополнительные каталоги через `--add-data` или измените имя выходного файла через `--name`.

## Рекомендации

- Экспорт в PDF недоступен без установленного Excel — используйте альтернативный компьютер или ограничьтесь Excel-форматом